<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Type Attack</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Poppins:wght@600&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; background: #05050a; color: #fff; font-family: 'Poppins', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; overflow: hidden; }
        
        #game-area { position: relative; width: 100%; height: 60vh; border-bottom: 2px solid #ff0055; margin-bottom: 20px; overflow: hidden; }
        .word { position: absolute; color: #00f2ea; font-family: 'Orbitron'; font-size: 1.2rem; white-space: nowrap; text-shadow: 0 0 5px #00f2ea; transition: top 0.1s linear; left: 50%; transform: translateX(-50%); }
        .word.danger { color: #ff0055; text-shadow: 0 0 10px #ff0055; }

        input { background: #222; border: 2px solid #00f2ea; padding: 10px; color: #fff; font-size: 1.2rem; text-align: center; border-radius: 20px; outline: none; width: 60%; font-family: 'Poppins'; }
        input:focus { box-shadow: 0 0 15px #00f2ea; }

        #score-board { position: absolute; top: 10px; right: 20px; font-family: 'Orbitron'; font-size: 1.5rem; color: #FFD700; }
        .back-btn { position: absolute; top: 10px; left: 20px; font-size: 2rem; cursor: pointer; z-index: 100; }
        
        #game-over { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); flex-direction: column; align-items: center; justify-content: center; z-index: 200; }
        button { background: #ff0055; border: none; padding: 15px 30px; color: white; font-family: 'Orbitron'; font-size: 1.2rem; cursor: pointer; border-radius: 30px; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="back-btn" onclick="quitGame()">âœ•</div>
    <div id="score-board">SCORE: 0</div>
    
    <div id="game-area"></div>
    <input type="text" id="input-field" placeholder="TYPE HERE..." autocomplete="off">

    <div id="game-over">
        <h1 style="font-family:'Orbitron'; color:#ff0055">SYSTEM HACKED</h1>
        <h2 id="final-score">0</h2>
        <button onclick="location.reload()">REBOOT SYSTEM</button>
    </div>

    <script>
        // --- WORD DICTIONARY ---
        const words = ["nebu", "star", "void", "flux", "core", "warp", "byte", "neon", "grid", "data", "link", "node", "zero", "hack", "code", "cyber", "laser", "orbit", "alien", "solar", "lunar", "comet", "alpha", "omega", "pulse", "sonic", "ultra", "hyper", "mega", "giga", "nano", "terra", "mech", "droid", "ship", "base", "gate", "portal", "rift", "time", "loop", "dash", "zoom", "blast"];
        
        const gameArea = document.getElementById('game-area');
        const input = document.getElementById('input-field');
        let activeWords = [];
        let score = 0;
        let gameActive = true;
        let spawnRate = 2000;
        let fallSpeed = 0.5; // Pixels per frame
        let lastSpawn = 0;

        function quitGame() { window.parent.postMessage('close_game', '*'); }

        function spawnWord() {
            const text = words[Math.floor(Math.random() * words.length)];
            const el = document.createElement('div');
            el.className = 'word';
            el.innerText = text;
            
            // Random Horizontal Position (Keep inside bounds)
            const x = 10 + Math.random() * 80; 
            el.style.left = x + '%';
            el.style.top = '-30px';
            
            gameArea.appendChild(el);
            activeWords.push({ el: el, text: text, y: -30 });
        }

        function gameLoop(timestamp) {
            if(!gameActive) return;

            // Spawning
            if(timestamp - lastSpawn > spawnRate) {
                spawnWord();
                lastSpawn = timestamp;
                if(spawnRate > 500) spawnRate -= 20; // Increase difficulty
                fallSpeed += 0.01; 
            }

            // Moving
            activeWords.forEach((obj, index) => {
                obj.y += fallSpeed;
                obj.el.style.top = obj.y + 'px';

                // Game Over Condition (Hit bottom)
                if(obj.y > gameArea.offsetHeight - 20) {
                    endGame();
                }
            });

            requestAnimationFrame(gameLoop);
        }

        input.addEventListener('input', (e) => {
            const val = input.value.toLowerCase().trim();
            const matchIndex = activeWords.findIndex(w => w.text === val);

            if(matchIndex !== -1) {
                // Correct Type
                const matched = activeWords[matchIndex];
                matched.el.style.color = '#FFD700';
                matched.el.style.transform = 'scale(1.5)';
                setTimeout(() => matched.el.remove(), 100);
                
                activeWords.splice(matchIndex, 1);
                input.value = '';
                score++;
                document.getElementById('score-board').innerText = "SCORE: " + score;

                // Send Stardust occasionally
                if(score % 10 === 0) window.parent.postMessage({ type: 'stardust_collected' }, '*');
            }
        });

        function endGame() {
            gameActive = false;
            document.getElementById('game-over').style.display = 'flex';
            document.getElementById('final-score').innerText = "SCORE: " + score;

            // --- CRITICAL FIX: SEND SCORE TO HUB ---
            window.parent.postMessage({
                type: 'game_over',
                game: 'typing', // MATCHES HUB ID
                score: score
            }, '*');
        }

        // Focus input automatically
        document.body.addEventListener('click', () => input.focus());
        input.focus();
        requestAnimationFrame(gameLoop);
    </script>
</body>
</html>
